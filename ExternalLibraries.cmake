#
# ExternalLibraries.cmake
#

CMAKE_MINIMUM_REQUIRED(VERSION 3.23)
INCLUDE(FetchContent)

# ZLib

FetchContent_Declare(
	zlib
	URL http://zlib.net/zlib-1.2.12.tar.gz
	URL_HASH SHA256=91844808532e5ce316b3c010929493c0244f3d37593afd6de04f71821d5136d9
	CMAKE_ARGS
		-DASM686:BOOL=OFF
		-DAMD64:BOOL=OFF
	PATCH_COMMAND
		${CMAKE_COMMAND} -DSCRIPT_FILE=${CMAKE_BINARY_DIR}/_deps/zlib-src/CMakeLists.txt -P ${CMAKE_SOURCE_DIR}/cmp0074.cmake
)

FetchContent_MakeAvailable(zlib)

FetchContent_Declare(
	taglib
	URL http://github.com/taglib/taglib/releases/download/v1.12/taglib-1.12.tar.gz
	URL_HASH SHA256=7fccd07669a523b07a15bd24c8da1bbb92206cb19e9366c3692af3d79253b703
	CMAKE_ARGS
		-DBUILD_SHARED_LIBS:BOOL=OFF
		-DENABLE_STATIC_RUNTIME:BOOL=OFF
		-DBUILD_EXAMPLES:BOOL=OFF
		-DBUILD_BINDINGS:BOOL=OFF
		-DZLIB_SOURCE:PATH=${zlib_SOURCE_DIR}
	PATCH_COMMAND
		${CMAKE_COMMAND} -DTAGLIB_DIR=${CMAKE_BINARY_DIR}/_deps/taglib-src -P ${CMAKE_SOURCE_DIR}/PatchTagLib.cmake
)

FetchContent_Declare(
	webp
	URL http://storage.googleapis.com/downloads.webmproject.org/releases/webp/libwebp-1.2.2.tar.gz
	URL_HASH SHA256=7656532F837AF5F4CEC3FF6BAFE552C044DC39BF453587BD5B77450802F4AEE6
	CMAKE_ARGS
		-DWEBP_ENABLE_SIMD:BOOL=OFF
		-DWEBP_BUILD_ANIM_UTILS:BOOL=OFF
		-DWEBP_BUILD_CWEBP:BOOL=OFF
		-DWEBP_BUILD_DWEBP:BOOL=OFF
		-DWEBP_BUILD_GIF2WEBP:BOOL=OFF
		-DWEBP_BUILD_IMG2WEBP:BOOL=OFF
		-DWEBP_BUILD_VWEBP:BOOL=OFF
		-DWEBP_BUILD_WEBPINFO:BOOL=OFF
		-DWEBP_BUILD_LIBWEBPMUX:BOOL=OFF
		-DWEBP_BUILD_WEBPMUX:BOOL=OFF
		-DWEBP_BUILD_EXTRAS:BOOL=OFF
		-DWEBP_BUILD_WEBP_JS:BOOL=OFF
		-DWEBP_USE_THREAD:BOOL=ON
		-DWEBP_NEAR_LOSSLESS:BOOL=ON
		-DWEBP_ENABLE_SWAP_16BIT_CSP:BOOL=OFF
		-DWEBP_UNICODE:BOOL=ON
		-DWEBP_BITTRACE:STRING=0
)

FetchContent_Declare(json
	URL http://github.com/nlohmann/json/releases/download/v3.10.5/json.tar.xz
	URL_HASH SHA256=344BE97B757A36C5B180F1C8162F6C5F6EBD760B117F6E64B77866E97B217280
)

# take them all
FetchContent_MakeAvailable(taglib webp json)

# make aliases

ADD_LIBRARY(ZLib ALIAS zlibstatic)
ADD_LIBRARY(TagLib ALIAS tag)
ADD_LIBRARY(WebP ALIAS webp)
ADD_LIBRARY(WebPDemux ALIAS webpdemux)
ADD_LIBRARY(WebPDecoder ALIAS webpdecoder)

# are we done?
